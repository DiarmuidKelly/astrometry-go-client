services:
  astrometry-solver:
    image: dm90/astrometry:latest
    container_name: ${CONTAINER_NAME:-astrometry-solver}
    volumes:
      # Mount astrometry index files (read-only)
      - ${ASTROMETRY_INDEX_PATH}:/usr/local/astrometry/data:ro

      # Shared volume for file exchange with your application
      # If using docker exec mode, your app needs access to this same path
      - /tmp/astrometry-shared:/shared-data

    # Keep container running for docker exec commands
    command: tail -f /dev/null

    restart: unless-stopped

    # Resource limits (adjust based on your needs)
    deploy:
      resources:
        limits:
          cpus: '2.0'
          memory: 4G
        reservations:
          cpus: '0.5'
          memory: 1G

# Usage:
# 1. Copy .env.example to .env and configure ASTROMETRY_INDEX_PATH
#    cp .env.example .env
#
# 2. Start the container:
#    docker compose up -d
#
# 3. Configure your Go client to use docker exec mode:
#    config := &solver.ClientConfig{
#        IndexPath:     "/path/to/astrometry-data",
#        UseDockerExec: true,
#        ContainerName: "astrometry-solver",
#    }
#
# 4. Stop the container:
#    docker compose down
#
# Note: This is optional for development convenience. You can also:
# - Use docker run mode (library spawns containers automatically)
# - Run the container manually with docker run
# - Use your own orchestration (k8s, systemd, etc.)
